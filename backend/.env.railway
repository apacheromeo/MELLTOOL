# ============================================
# RAILWAY + SUPABASE DEPLOYMENT
# Environment Variables
# ============================================
# Set these in Railway Dashboard:
# Your Service → Variables tab
# ============================================

# ============================================
# DATABASE (SUPABASE)
# ============================================
# Get from Supabase Dashboard:
# Project Settings → Database → Connection Pooling
# Use the "Transaction mode" connection string
#
# Format:
# postgresql://postgres.[project-ref]:[password]@aws-0-[region].pooler.supabase.com:6543/postgres?pgbouncer=true
#
# IMPORTANT: Must use connection pooler (port 6543) and add ?pgbouncer=true
DATABASE_URL=postgresql://postgres.[project-ref]:[password]@aws-0-[region].pooler.supabase.com:6543/postgres?pgbouncer=true

# ============================================
# REDIS (RAILWAY PLUGIN)
# ============================================
# Railway will automatically set this when you add Redis plugin
# Format: redis://default:[password]@[host]:[port]
# REDIS_URL will be auto-provided by Railway

# ============================================
# APPLICATION SETTINGS
# ============================================
NODE_ENV=production
PORT=3001

# ============================================
# JWT SECRETS
# ============================================
# Generate with: openssl rand -base64 64
# Or use Railway's secret generator
JWT_SECRET=your-jwt-secret-64-characters-minimum
JWT_REFRESH_SECRET=your-jwt-refresh-secret-different-from-above
SESSION_SECRET=your-session-secret-32-characters-minimum

# Token expiration
JWT_ACCESS_EXPIRATION=15m
JWT_REFRESH_EXPIRATION=7d

# ============================================
# FRONTEND URL (VERCEL)
# ============================================
# Your Vercel deployment URL
# Get from: Vercel dashboard after deploying frontend
# Example: https://your-app.vercel.app
# NO trailing slash!
FRONTEND_URL=https://your-app.vercel.app

# Allowed CORS origins (same as FRONTEND_URL)
# For multiple domains, use comma-separated:
# https://your-app.vercel.app,https://custom-domain.com
ALLOWED_ORIGINS=https://your-app.vercel.app

# ============================================
# SECURITY & RATE LIMITING
# ============================================
RATE_LIMIT_TTL=900
RATE_LIMIT_MAX=100
MAX_FILE_SIZE=5242880
LOG_LEVEL=info

# ============================================
# OPTIONAL - Supabase Storage
# ============================================
# If using Supabase for file uploads

# Supabase project URL
# Get from: Supabase → Project Settings → API
# SUPABASE_URL=https://[project-ref].supabase.co

# Supabase service role key (backend only - keep secret!)
# Get from: Supabase → Project Settings → API → service_role
# SUPABASE_SERVICE_KEY=your-service-role-key

# ============================================
# OPTIONAL - Monitoring & Error Tracking
# ============================================

# Sentry for error tracking (recommended for production)
# Get from: https://sentry.io
# SENTRY_DSN=https://xxxxx@xxxxx.ingest.sentry.io/xxxxx

# ============================================
# OPTIONAL - Email Configuration
# ============================================

# For sending notifications, password resets, etc.
# SMTP_HOST=smtp.gmail.com
# SMTP_PORT=587
# SMTP_SECURE=false
# SMTP_USER=your-email@gmail.com
# SMTP_PASSWORD=your-app-password
# EMAIL_FROM=noreply@your-domain.com

# ============================================
# HOW TO SET THESE IN RAILWAY
# ============================================
#
# Method 1: Railway Dashboard (Recommended)
# 1. Go to: https://railway.app/project/[your-project]
# 2. Click your backend service
# 3. Click "Variables" tab
# 4. Click "New Variable" or "Raw Editor"
# 5. Paste all variables (Railway supports multi-line paste!)
# 6. Click "Deploy" or it auto-deploys
#
# Method 2: Railway CLI
# railway variables set DATABASE_URL="postgresql://..."
# railway variables set FRONTEND_URL="https://..."
#
# ============================================
# RAILWAY FEATURES
# ============================================
#
# ✅ Automatic HTTPS
# ✅ Zero-config deployments
# ✅ Automatic environment detection
# ✅ Built-in metrics
# ✅ Generous free tier ($5/month credit)
# ✅ No cold starts (unlike Render free tier)
# ✅ Instant rollbacks
# ✅ PostgreSQL and Redis plugins available
#
# ============================================
# SETUP ORDER
# ============================================
#
# 1. Create Supabase project (see SUPABASE_SETUP.md)
# 2. Get DATABASE_URL from Supabase (connection pooler)
# 3. Create Railway project
# 4. Add Redis plugin in Railway
# 5. Deploy backend to Railway (auto-detect)
# 6. Add environment variables in Railway
# 7. Deploy frontend to Vercel
# 8. Update FRONTEND_URL in Railway
# 9. Run database migrations
# 10. Create admin user
#
# ============================================
# SUPABASE CONNECTION TROUBLESHOOTING
# ============================================
#
# If you see "too many connections" error:
# - Make sure you're using connection pooler URL (port 6543)
# - Make sure ?pgbouncer=true is at the end
# - Add connection_limit=10 parameter:
#   DATABASE_URL=postgresql://...?pgbouncer=true&connection_limit=10
#
# If database connection times out:
# - Verify Supabase project is not paused (free tier)
# - Check DATABASE_URL is correct (no typos)
# - Test connection: npx prisma db pull
#
# If migrations fail:
# - Use Railway's one-click deployment hooks
# - Or run migrations locally before deploying
#
# ============================================
# QUICK LINKS
# ============================================
#
# Railway Dashboard:
# https://railway.app/project/[your-project]
#
# Railway Variables:
# https://railway.app/project/[your-project]/service/[service-id]/variables
#
# Railway Deployments:
# https://railway.app/project/[your-project]/service/[service-id]/deployments
#
# Railway Metrics:
# https://railway.app/project/[your-project]/service/[service-id]/metrics
#
# Supabase Dashboard:
# https://app.supabase.com/project/[your-project]
#
# Supabase Database Settings:
# https://app.supabase.com/project/[your-project]/settings/database
#
# Vercel Dashboard:
# https://vercel.com/[your-project]
#
# ============================================
# RAILWAY-SPECIFIC TIPS
# ============================================
#
# 1. Railway auto-detects frameworks (Node.js, Prisma, etc.)
# 2. No need for Dockerfile in most cases
# 3. Use Railway CLI for local development:
#    npm install -g @railway/cli
#    railway login
#    railway link
#    railway run npm run start:dev
# 4. Railway provides $5/month credit on free tier
# 5. No cold starts - service stays warm
# 6. Automatic SSL for all deployments
# 7. Can deploy directly from GitHub (auto-deploy on push)
#
# ============================================
